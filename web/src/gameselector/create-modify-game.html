<dom-module id="ghvz-create-modify-game">
  <script>
    // Not sure why this HTMLImports.whenReady is really needed.
    // Something about polymer initialization order.
    // I think we're not supposed to need this.
    HTMLImports.whenReady(() => {
      Polymer({
        is: 'ghvz-create-modify-game',

        properties: {
          bridge: Object,
          userId: String,
        },


        makeFormBlueprint_: function() {
          return {
            fields: [
              {
                property: "id",
                label: "Id",
                description: "Will appear in the url, keep it short. 'game-' will be automatically prepended. Example '2017m' will become 'game-2017m'."
              },
              {
                property: "name",
                label: "Name",
              },
              {
                property: "rulesHtml",
                label: "Rules html",
                description: "HTML describing the rules",
              },
              {
                property: "stunTimer",
                label: "Stun timer (in seconds)",
                description: "(in seconds)"
              }
            ],
          };
        },

        editGame_: function() {
          this.$.gameForm.openForEditing(this.game)
              .then((properties) => {
                properties.gameId = this.game.id;
                delete properties.id;
                this.bridge.updateGame(properties);
              });
        },

        addGame_: function() {
          this.$.gameForm.openForAdding()
              .then((properties) => {
                if (!properties.id.startsWith('game-'))
                  properties.id = 'game-' + properties.id;
                properties.gameId = properties.id;
                delete properties.id;
                properties.stunTimer = +properties.stunTimer;
                properties.firstAdminUserId = this.userId;
                this.bridge.createGame(properties);
              });
        },
      });
    });
  </script>
  <style>
    :host {
      display: flex;
    }
    #create, #modify {
      display: none;
    }
    paper-button {
      margin: 8px;
    }
    :host[create] #create {
      display: block;
    }
    :host[modify] #modify {
      display: block;
    }
  </style>
  <template>
    <paper-button id="create" raised on-tap="addGame_">Create Game</paper-button>
    <paper-button id="modify" raised on-tap="editGame_">Modify Game</paper-button>
    <ghvz-super-form
        id="gameForm"
        type-name="Game"
        blueprint="[[makeFormBlueprint_()]]">
      <ghvz-form-section spaced>
        For timestamps, use <a href="https://www.epochconverter.com/">epochconverter</a>.
        Timestamps are in milliseconds.
      </ghvz-form-section>
    </ghvz-super-form>
  </template>
</dom-module>
