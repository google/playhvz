<dom-module id="ghvz-game-selector">
  <script>
    // Not sure why this HTMLImports.whenReady is really needed.
    // Something about polymer initialization order.
    // I think we're not supposed to need this.
    HTMLImports.whenReady(() => {
      Polymer({
        is: 'ghvz-game-selector',

        properties: {
          userId: {
            type: String,
          },

          user: {
            type: Object,
          },

          games: {
            type: Array,
          },

          gameId: {
            type: String,
            notify: true,
            value: null,
          },

          playerId: {
            type: String,
            notify: true,
            value: null,
          },
        },

        observers: [
          'autoChooseGame_(userId, user.*)',
        ],

        autoChooseGame_: function() {
          if (this.gameId == null && this.playerId == null) {
            if (this.user && this.user.players) {
              for (let userPlayer of this.user.players) {
                // pick the first one
                this.gameId = userPlayer.gameId;
                this.playerId = userPlayer.playerId;
                this.$.gameChooser.selected = this.user.players.indexOf(userPlayer);
                break;
              }
            }
          }
        },

        chooseGame_: function(e) {
          let gameIndex = this.$.gameChooser.selected;
          this.gameId = this.games[gameIndex].id;
        },
      });
    });
  </script>
  <template>
    <paper-dropdown-menu label="Game">
      <paper-listbox id="gameChooser" class="dropdown-content" on-iron-select="chooseGame_">
        <template is="dom-repeat" items="[[games]]" as="game">
          <paper-item data-game-id$="[[game.id]]">[[game.name]]</paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>
  </template>
</dom-module>
