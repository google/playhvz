
<dom-module id="ghvz-mobile-main-page">
<script>
  // Not sure why this HTMLImports.whenReady is really needed.
  // Something about polymer initialization order.
  // I think we're not supposed to need this.
  HTMLImports.whenReady(() => {
    Polymer({
      is: 'ghvz-mobile-main-page',

      properties: {
        bridge: Object,
        database: Object,

        userId: {
          type: String,
        },

        gameId: {
          type: String,
          notify: true,
        },

        playerId: {
          type: String,
          notify: true,
        },

        canInfect: {
          type: Boolean,
          computed: 'computeCanInfect_(playerId, database.game, database.game.playersById.*)',
        },

        canRegister: {
          type: Boolean,
          computed: 'computeCanRegister_(gameId, playerId)',
        },

        isPlayer: {
          type: Boolean,
          computed: 'computeIsPlayer_(playerId)',
        },
        
        isAdmin: {
          type: Boolean,
          computed: 'computeIsAdmin_(userId, database.game, database.game.admins.*)',
        },
      },

      computeCanInfect_: function(playerId, game) {
        return game.playersById[playerId] && !game.playersById[playerId].infectable;
      },

      computeCanRegister_(gameId, playerId) {
        return gameId && !playerId;
      },

      computeIsPlayer_(playerId) {
        return !!playerId;
      },

      computeIsAdmin_: function(userId, game) {
        let admin = game.admins.find((admin) => admin.userId == userId);
        return !!admin;
      },
    });
  });
</script>
<style>
  :host {
    display: block;
    position: relative;
    width: 100%;
    height: 100%;
  }
  .paper-header {
    background-color: #03a9f4;
    color: white;
    font-size: 18px;
    line-height: 48px;
    font-weight: bold;
  }
  ghvz-card {
    min-height: 100%;
  }
</style>
<template>
  <ghvz-card full expand with-menu>
    <div class="header">Humans vs Zombies</div>
    <template is="dom-if" if="[[canRegister]]">
      <ghvz-card spaced full>
        <div class="header">Join Game</div>
        <ghvz-game-registration
            class="content"
            bridge="[[bridge]]"
            game-id="[[gameId]]"
            user-id="[[userId]]">
        </ghvz-game-registration>
      </ghvz-card>
    </template>

    <template is="dom-if" if="[[isPlayer]]">
      <template is="dom-if" if="[[canInfect]]">
        <ghvz-card spaced full>
          <div class="header">Infect</div>
          <ghvz-infect
              bridge="[[bridge]]"
              game-id="[[gameId]]"
              player-id="[[playerId]]">
          </ghvz-infect>
        </ghvz-card>
      </template>

      <ghvz-card spaced full>
        <div class="header">Next Mission</div>
        <ghvz-next-mission
            bridge="[[bridge]]"
            missions="[[database.game.missions]]"
            game-id="[[gameId]]"
            player-id="[[playerId]]">
        </ghvz-next-mission>
      </ghvz-card>
    </template>
  </ghvz-card>
</template>
</dom-module>